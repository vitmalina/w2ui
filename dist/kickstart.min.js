/* kicstart 0.2.x (nightly) (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var kickStart=function(){function define(a){"string"==typeof a&&$.ajax({url:app._config.baseURL+a,dataType:"text",cache:app._config.cache,async:!1,success:function(b,c,d){if("success"!=c)return void console.log('ERROR: error while loading module definition from "'+a+'".');try{a=JSON.parse(b)}catch(e){return void console.log('ERROR: not valid JSON file  "'+a+'".\n'+e)}},error:function(b,c,d){console.log('ERROR: error while loading module definition from "'+a+'".')}});for(var b in a){if(app._config.modules.hasOwnProperty(b))return console.log("ERROR: module "+b+" is already registered."),!1;app._config.modules[b]=$.extend({assets:{}},a[b],{ready:!1,files:{}})}return!0}function register(a,b){if(app.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is already registered"),!1;if(!app._config.modules.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is not defined, first define it with kickStart.define"),!1;var c=app._config.modules[a];app[a]=b(c.files,c),app._config.modules[a].ready=!0}function require(names,callBack){function isFinished(){0==modCount&&(failed!==!0&&("function"==typeof promise._done&&promise._done(app._config.modules[name]),"function"==typeof callBack&&callBack()),"function"==typeof promise._always&&promise._always())}$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(a){return promise._ready=a,promise},fail:function(a){return promise._fail=a,promise},done:function(a){return promise._done=a,promise},always:function(a){return promise._always=a,promise}};return setTimeout(function(){for(var n in names){var name=names[n];"undefined"!=typeof app[name]?(modCount--,isFinished()):"undefined"==typeof app._config.modules[name]?console.log("ERROR: module "+name+" is not defined."):!function(name){getFiles(app._config.modules[name].assets.concat([app._config.modules[name].start]),function(files){var start=files[app._config.modules[name].start];delete files[app._config.modules[name].start],app._config.modules[name].files=files,app._config.modules[name].ready=!0;try{eval(start)}catch(e){failed=!0;var err=e.stack.split("\n"),tmp=err[1].match(/<anonymous>:([\d]){1,10}:([\d]{1,10})/gi);tmp&&(tmp=tmp[0].split(":")),tmp?(console.error("ERROR: "+err[0]+" ==> "+app._config.modules[name].start+", line: "+tmp[1]+", character: "+tmp[2]),console.log(e.stack)):(console.error("ERROR: "+app._config.modules[name].start),console.log(e.stack)),"function"==typeof promise._fail&&promise._fail(app._config.modules[name])}"function"==typeof promise._ready&&promise._ready(app._config.modules[name]),modCount--,isFinished()})}(name)}},1),promise}function getFiles(a,b){function c(){e--,0>=e&&b(d)}var d={},e=a.length;for(var f in a)!function(){var b=a[f];$.ajax({url:app._config.baseURL+b,dataType:"text",cache:app._config.cache,success:function(a,e,f){return"success"!=e?void console.log("ERROR: error while getting a file "+b+"."):(d[b]=f.responseText,void c())},error:function(e,g,h){"error"==g?console.log("ERROR: failed to load "+a[f]+"."):(console.log('ERROR: file "'+a[f]+'" is loaded, but with a parsing error(s) in line '+h.line+": "+h.message),d[b]=xhr.responseText,c())}})}()}var app={_config:{baseURL:"",cache:!1,modules:{}},define:define,require:require,register:register};return window.app||(window.app=app),app}();kickStart.define({route:{}}),kickStart.register("route",function(){function a(a,b){if("object"==typeof a){for(var c in a){var d=String("/"+c).replace(/\/{2,}/g,"/");l[d]=a[c]}return k.route}if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof k.route.trigger){var e=k.route.trigger({phase:"before",type:"add",target:"self",route:a,handler:b});if(e.isCancelled===!0)return!1}return l[a]=b,"function"==typeof k.route.trigger&&k.route.trigger($.extend(e,{phase:"after"})),k.route}function b(a){if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof k.route.trigger){var b=k.route.trigger({phase:"before",type:"remove",target:"self",route:a,handler:handler});if(b.isCancelled===!0)return!1}return delete l[a],delete m[a],"function"==typeof k.route.trigger&&k.route.trigger($.extend(b,{phase:"after"})),k.route}function c(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),setTimeout(function(){window.location.hash=a},1),k.route}function d(a){return j=!0,c(a),setTimeout(function(){j=!1},1),k.route}function e(){return window.location.hash.substr(1).replace(/\/{2,}/g,"/")}function f(){h();var a={};for(var b in l){var c=m[b].keys,d=[];for(var e in c)d.push(c[e].name);a[b]=d}return a}function g(){if(j!==!0){h();var a=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==a&&(a="/");var b=a.split("/");if(b[1]&&"undefined"==typeof k[b[1]]){if("function"==typeof k.route.trigger){var c=k.route.trigger({phase:"before",type:"route",target:"self",route:a});if(c.isCancelled===!0)return!1}k.require(b[1]).done(function(){k.modules[b[1]]&&g()}),"function"==typeof k.route.trigger&&k.route.trigger($.extend(c,{phase:"after"}))}else for(var d in m){var e={},b=m[d].path.exec(a);if(b){var f=1;for(var i in m[d].keys)e[m[d].keys[i].name]=b[f],f++;if("function"==typeof k.route.trigger){var c=k.route.trigger({phase:"before",type:"route",target:"self",route:d,params:e});if(c.isCancelled===!0)return!1}l[d](d,e),"function"==typeof k.route.trigger&&k.route.trigger($.extend(c,{phase:"after"}))}}}}function h(){for(var a in l)if(!m[a]){var b=[],c=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");m[a]={path:new RegExp("^"+c+"$","i"),keys:b}}}function i(){window.addEventListener?window.addEventListener("hashchange",g,!1):window.attachEvent("onhashchange",g)}var j,k=kickStart,l={},m={};i();var n={add:a,remove:b,go:c,set:d,get:e,process:g,list:f,onAdd:null,onRemove:null,onRoute:null};return"undefined"!=typeof w2utils&&$.extend(n,w2utils.event,{handlers:[]}),n});