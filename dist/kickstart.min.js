/* kicstart 0.2.x (nightly) (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var kickStart=function(){function define(a){"string"==typeof a&&$.ajax({url:app._conf.baseURL+a,dataType:"text",cache:app._conf.cache,async:!1,success:function(b,c,d){if("success"!=c)return void console.log('ERROR: error while loading module definition from "'+a+'".');try{a=JSON.parse(b)}catch(b){return void console.log('ERROR: not valid JSON file  "'+a+'".\n'+b)}},error:function(b,c,d){console.log('ERROR: error while loading module definition from "'+a+'".')}});for(var b in a){if(app._conf.modules.hasOwnProperty(b))return console.log("ERROR: module "+b+" is already registered."),!1;app._conf.modules[b]=$.extend({assets:{}},a[b],{ready:!1,files:{}})}return!0}function register(a,b){if(app.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is already registered"),!1;if(!app._conf.modules.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is not defined, first define it with kickStart.define"),!1;var c=app._conf.modules[a];app[a]=b(c.files,c),app._conf.modules[a].ready=!0}function require(names,callBack){function isFinished(){0==modCount&&(failed!==!0&&("function"==typeof promise._done&&promise._done(app._conf.modules[name]),"function"==typeof callBack&&callBack()),"function"==typeof promise._always&&promise._always())}$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(a){return promise._ready=a,promise},fail:function(a){return promise._fail=a,promise},done:function(a){return promise._done=a,promise},always:function(a){return promise._always=a,promise}};return setTimeout(function(){for(var n in names){var name=names[n];"undefined"!=typeof app[name]?(modCount--,isFinished()):"undefined"==typeof app._conf.modules[name]?console.log("ERROR: module "+name+" is not defined."):!function(name){getFiles(app._conf.modules[name].assets.concat([app._conf.modules[name].start]),function(files){var start=files[app._conf.modules[name].start];delete files[app._conf.modules[name].start],app._conf.modules[name].files=files,app._conf.modules[name].ready=!0;try{eval(start)}catch(a){failed=!0;var err=a.stack.split("\n"),tmp=err[1].match(/<anonymous>:([\d]){1,10}:([\d]{1,10})/gi);tmp&&(tmp=tmp[0].split(":")),tmp?(console.error("ERROR: "+err[0]+" ==> "+app._conf.modules[name].start+", line: "+tmp[1]+", character: "+tmp[2]),console.log(a.stack)):(console.error("ERROR: "+app._conf.modules[name].start),console.log(a.stack)),"function"==typeof promise._fail&&promise._fail(app._conf.modules[name])}"function"==typeof promise._ready&&promise._ready(app._conf.modules[name]),modCount--,isFinished()})}(name)}},1),promise}function getFiles(a,b){function c(){e--,e<=0&&b(d)}var d={},e=a.length;for(var f in a)!function(){var b=a[f],e=$('script[path="'+b+'"]');e.length>0?(d[b]=e.html(),c()):$.ajax({url:app._conf.baseURL+b,dataType:"text",cache:app._conf.cache,success:function(a,e,f){return"success"!=e?void console.log("ERROR: error while getting a file "+b+"."):(d[b]=f.responseText,void c())},error:function(e,g,h){"error"==g?console.log("ERROR: failed to load "+a[f]+"."):(console.log('ERROR: file "'+a[f]+'" is loaded, but with a parsing error(s) in line '+h.line+": "+h.message),d[b]=xhr.responseText,c())}})}()}var app={_conf:{name:"unnamed",baseURL:"",cache:!1,modules:{}},define:define,require:require,register:register};return window.app||(window.app=app),app}();kickStart.define({route:{}}),kickStart.register("route",function(){function a(a){""===f()?d(a):h()}function b(a,b){if("object"==typeof a){for(var c in a){var d=String("/"+c).replace(/\/{2,}/g,"/");m[d]=a[c]}return l.route}if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof l.route.trigger){var e=l.route.trigger({phase:"before",type:"add",target:"self",route:a,handler:b});if(e.isCancelled===!0)return!1}return m[a]=b,"function"==typeof l.route.trigger&&l.route.trigger($.extend(e,{phase:"after"})),l.route}function c(a){if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof l.route.trigger){var b=l.route.trigger({phase:"before",type:"remove",target:"self",route:a,handler:handler});if(b.isCancelled===!0)return!1}return delete m[a],delete n[a],"function"==typeof l.route.trigger&&l.route.trigger($.extend(b,{phase:"after"})),l.route}function d(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),setTimeout(function(){window.location.hash=a},1),l.route}function e(a){return k=!0,a=String("/"+a).replace(/\/{2,}/g,"/"),window.location.hash=a,setTimeout(function(){k=!1},1),l.route}function f(){return window.location.hash.substr(1).replace(/\/{2,}/g,"/")}function g(){i();var a={};for(var b in m){var c=n[b].keys,d=[];for(var e in c)d.push(c[e].name);a[b]=d}return a}function h(){if(k!==!0){i();var a=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==a&&(a="/");var b=!1;for(var c in n){var d={},e=n[c].path.exec(a);if(e){b=!0;var f=1;for(var g in n[c].keys)d[n[c].keys[g].name]=e[f],f++;if("function"==typeof l.route.trigger){var j=l.route.trigger({phase:"before",type:"route",target:"self",route:c,params:d});if(j.isCancelled===!0)return!1}m[c]($.extend({name:c,path:a},d)),"function"==typeof l.route.trigger&&l.route.trigger($.extend(j,{phase:"after"}))}}if(!b){var o=l._conf.modules;for(var p in o){var q=o[p],r=q.route;if("string"==typeof r&&(r=r.replace(/\/{2,}/g,"/"),"*"==r[r.length-1]&&(r=r.substr(0,r.length-1))),!q.ready&&q.route&&0===a.indexOf(r))return void l.require(p).done(function(){l._conf.modules[p]&&h()})}if("function"==typeof l.route.trigger){var j=l.route.trigger({phase:"before",type:"error",target:"self",hash:a});if(j.isCancelled===!0)return!1}console.log('ERROR: route "'+a+'" not found'),"function"==typeof l.route.trigger&&l.route.trigger($.extend(j,{phase:"after"}))}}}function i(){for(var a in m)if(!n[a]){var b=[],c=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");n[a]={path:new RegExp("^"+c+"$","i"),keys:b}}}function j(){window.addEventListener?window.addEventListener("hashchange",h,!1):window.attachEvent("onhashchange",h)}var k,l=kickStart,m={},n={};j();var o={init:a,add:b,remove:c,go:d,set:e,get:f,process:h,list:g,onAdd:null,onRemove:null,onRoute:null};return"undefined"!=typeof w2utils&&$.extend(o,w2utils.event,{handlers:[]}),o});