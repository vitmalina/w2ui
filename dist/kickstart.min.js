/* kicstart 0.x (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var app=!function(){function header(e){$("#app-header").html(e)}function timer(){timer_start=(new Date).getTime(),timer_lap=(new Date).getTime(),console.log("Start Timer")}function lap(e){typeof e!="string"?e="":e=' "'+e+'"',console.log("Total:",(new Date).getTime()-timer_start,"Lap"+e+":",(new Date).getTime()-timer_lap),timer_lap=(new Date).getTime()}function register(e,t){if(app.hasOwnProperty(e))return console.log("ERROR: Namespace "+e+" is already registered"),!1;var n=null;for(var r in app.modules)app.modules[r].name==e&&(n=app.modules[r]);app[e]=t(n.files,n);return}function load(names){function isFinished(){modCount==0&&(failed!==!0&&(typeof app.config.done=="function"&&app.config.done(app.modules[name]),typeof promise._done=="function"&&promise._done(app.modules[name])),typeof app.config.always=="function"&&app.config.always(app.modules[name]),typeof promise._always=="function"&&promise._always())}$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(e){return promise._ready=e,promise},fail:function(e){return promise._fail=e,promise},done:function(e){return promise._done=e,promise},always:function(e){return promise._always=e,promise}};return setTimeout(function(){for(var n in names){var name=names[n];typeof app.modules[name]!="undefined"?(modCount--,isFinished()):$.ajax({url:name+"/module.json",dataType:"json"}).done(function(data,status,xhr){data.main.substr(0,1)!="/"&&(data.main=name+"/"+data.main);for(var a in data.assets)data.assets[a].substr(0,1)!="/"&&(data.assets[a]=name+"/"+data.assets[a]);app.modules[name]=data,app.get(data.assets.concat([data.main]),function(files){var main=files[data.main];delete files[data.main],app.modules[name].files=files,app.modules[name].status="loaded";try{eval(main)}catch(e){failed=!0;var err=e.stack.split("\n"),tmp=err[1].match(/<anonymous>:([\d]){1,10}:([\d]{1,10})/gi)[0].split(":");console.error("ERROR: "+err[0]+" ==> "+data.main+", line: "+tmp[1]+", character: "+tmp[2]),console.log(e.stack),typeof app.config.fail=="function"&&app.config.fail(app.modules[name]),typeof promise._fail=="function"&&promise._fail(app.modules[name])}typeof app.config.ready=="function"&&app.config.ready(app.modules[name]),typeof promise._ready=="function"&&promise._ready(app.modules[name]),modCount--,isFinished()})}).fail(function(e,t,n){app.modules[name]={status:"error",msg:"Error while loading cofing"},failed=!0,typeof app.config.fail=="function"&&app.config.fail(app.modules[name]),typeof promise._fail=="function"&&promise._fail(app.modules[name]),modCount--,isFinished()})}},1),promise}function get(e,t){function s(){r--,r<=0&&t(n)}var n={},r=e.length;for(var i in e)(function(){var t=i,r=e[i];$.ajax({url:r,dataType:"text",success:function(e,t,i){if(t!="success"){console.log("ERROR: error while getting a file "+r+".");return}n[r]=i.responseText,s()},error:function(t,o,u){o=="error"?console.log("ERROR: failed to load "+e[i]+"."):(console.log('ERROR: file "'+e[i]+'" is loaded, but with a parsing error(s) in line '+u.line+": "+u.message),n[r]=responseObj.responseText,s())}})})()}function include(e){typeof e=="string"&&(e=[e]);for(var t in e)$(document).append('<script type="text/javascript" src="'+e[t]+'"></script>')}function init(){app.get(["app/conf/session.js"],function(data){try{for(var i in data)eval(data[i])}catch(e){}if(document.location.href.indexOf("login.html")>0)return;app.user=app.session();if($.isEmptyObject(app.user)){document.location="login.html";return}var files=["app/conf/action.js","app/conf/config.js","app/conf/start.js"];app.get(files,function(data){try{for(var i in data)eval(data[i])}catch(e){app.include(files)}$("#app-toolbar").w2toolbar(app.config.app_toolbar),$("#app-tabs").w2tabs(app.config.app_tabs),$("#app-main").w2layout(app.config.app_layout),setTimeout(function(){$("#app-container").fadeIn(200),setTimeout(function(){var e=0;app.config.show.toolbar?($("#app-toolbar").css("height","30px").show(),e+=30):$("#app-toolbar").hide(),app.config.show.tabs?($("#app-tabs").css({top:e+"px",height:"30px"}).show(),e+=30):$("#app-tabs").hide(),$("#app-top").css("height",e+"px").show(),app.config.show.header?($("#app-header").css({top:e+"px",height:"60px"}).show(),e+=60):$("#app-header").hide(),$("#app-main").css("top",e+"px"),typeof app.start=="function"&&app.start()},200)},100)})})}var timer_start,timer_lap,app={};return app.user={},app.config={},app.modules={},app.header=header,app.timer=timer,app.lap=lap,app.register=register,app.load=load,app.get=get,app.include=include,app.action=null,app.start=null,app.session=null,app.login=null,app.logout=null,app.forgot=null,init(),app}(app||{});
