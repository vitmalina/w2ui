/* kicstart 0.1.x (nightly) (c) http://w2ui.com/kickstart, vitmalina@gmail.com */
var kickStart=function(){function define(a){"string"==typeof a&&$.ajax({url:a,dataType:"text",cache:!1,async:!1,success:function(b,c){if("success"!=c)return void console.log('ERROR: error while loading module definition from "'+a+'".');try{a=JSON.parse(b)}catch(d){return void console.log('ERROR: not valid JSON file  "'+a+'".\n'+d)}},error:function(){console.log('ERROR: error while loading module definition from "'+a+'".')}}),$.isArray(a)||(a=[a]);for(var b in a){if(app.modules.hasOwnProperty(a[b].name))return console.log("ERROR: module "+a[b].name+" is already registered."),!1;app.modules[a[b].name]=$.extend({},a[b],{loaded:!1,files:{}})}return!0}function register(a,b){if(app.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is already registered"),!1;if(!app.modules.hasOwnProperty(a))return console.log("ERROR: Namespace "+a+" is not defined, first define it with kickStart.define"),!1;var c=null;for(var d in app.modules)app.modules[d].name==a&&(c=app.modules[d]);app[a]=b(c.files,c),app.modules[a].loaded=!0}function require(names,callBack){function isFinished(){0==modCount&&(failed!==!0&&("function"==typeof app.config.done&&app.config.done(app.modules[name]),"function"==typeof promise._done&&promise._done(app.modules[name]),"function"==typeof callBack&&callBack()),"function"==typeof app.config.always&&app.config.always(app.modules[name]),"function"==typeof promise._always&&promise._always())}$.isArray(names)||(names=[names]);var modCount=names.length,failed=!1,promise={ready:function(a){return promise._ready=a,promise},fail:function(a){return promise._fail=a,promise},done:function(a){return promise._done=a,promise},always:function(a){return promise._always=a,promise}};return setTimeout(function(){for(var n in names){var name=names[n];"undefined"!=typeof app[name]?(modCount--,isFinished()):"undefined"==typeof app.modules[name]?console.log("ERROR: module "+name+" is not defined."):!function(name){getFiles(app.modules[name].assets.concat([app.modules[name].main]),function(files){var main=files[app.modules[name].main];delete files[app.modules[name].main],app.modules[name].files=files,app.modules[name].loaded=!0;try{eval(main)}catch(e){failed=!0;var err=e.stack.split("\n"),tmp=err[1].match(/<anonymous>:([\d]){1,10}:([\d]{1,10})/gi);tmp&&(tmp=tmp[0].split(":")),tmp?(console.error("ERROR: "+err[0]+" ==> "+app.modules[name].main+", line: "+tmp[1]+", character: "+tmp[2]),console.log(e.stack)):(console.error("ERROR: "+app.modules[name].main),console.log(e.stack)),"function"==typeof app.config.fail&&app.config.fail(app.modules[name]),"function"==typeof promise._fail&&promise._fail(app.modules[name])}"function"==typeof app.config.ready&&app.config.ready(app.modules[name]),"function"==typeof promise._ready&&promise._ready(app.modules[name]),modCount--,isFinished()})}(name)}},1),promise}function getFiles(a,b){function c(){e--,0>=e&&b(d)}var d={},e=a.length;for(var f in a)!function(){var b=a[f];$.ajax({url:b,dataType:"text",cache:!1,success:function(a,e,f){return"success"!=e?void console.log("ERROR: error while getting a file "+b+"."):(d[b]=f.responseText,void c())},error:function(e,g,h){"error"==g?console.log("ERROR: failed to load "+a[f]+"."):(console.log('ERROR: file "'+a[f]+'" is loaded, but with a parsing error(s) in line '+h.line+": "+h.message),d[b]=xhr.responseText,c())}})}()}var app={modules:{},config:{},define:define,require:require,register:register};return app}();kickStart.define({name:"route"}),kickStart.register("route",function(){function a(a,b){if("object"==typeof a){for(var c in a){var d=String("/"+c).replace(/\/{2,}/g,"/");j[d]=a[c]}return i.route}if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof i.route.trigger){var e=i.route.trigger({phase:"before",type:"add",target:"self",route:a,handler:b});if(e.isCancelled===!0)return!1}return j[a]=b,"function"==typeof i.route.trigger&&i.route.trigger($.extend(e,{phase:"after"})),i.route}function b(a){if(a=String("/"+a).replace(/\/{2,}/g,"/"),"function"==typeof i.route.trigger){var b=i.route.trigger({phase:"before",type:"remove",target:"self",route:a,handler:handler});if(b.isCancelled===!0)return!1}return delete j[a],delete k[a],"function"==typeof i.route.trigger&&i.route.trigger($.extend(b,{phase:"after"})),i.route}function c(a){return a=String("/"+a).replace(/\/{2,}/g,"/"),setTimeout(function(){window.location.hash=a},1),i.route}function d(){return window.location.hash.substr(1).replace(/\/{2,}/g,"/")}function e(){g();var a={};for(var b in j){var c=k[b].keys,d=[];for(var e in c)d.push(c[e].name);a[b]=d}return a}function f(){g();var a=window.location.hash.substr(1).replace(/\/{2,}/g,"/");""==a&&(a="/");var b=a.split("/");if(b[1]&&"undefined"==typeof i[b[1]]){if("function"==typeof i.route.trigger){var c=i.route.trigger({phase:"before",type:"route",target:"self",route:a});if(c.isCancelled===!0)return!1}i.require(b[1]).done(function(){i.modules[b[1]]&&f()}),"function"==typeof i.route.trigger&&i.route.trigger($.extend(c,{phase:"after"}))}else for(var d in k){var e={},b=k[d].path.exec(a);if(b){var h=1;for(var l in k[d].keys)e[k[d].keys[l].name]=b[h],h++;if("function"==typeof i.route.trigger){var c=i.route.trigger({phase:"before",type:"route",target:"self",route:d,params:e});if(c.isCancelled===!0)return!1}j[d](d,e),"function"==typeof i.route.trigger&&i.route.trigger($.extend(c,{phase:"after"}))}}}function g(){for(var a in j)if(!k[a]){var b=[],c=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,f,g){return b.push({name:e,optional:!!g}),c=c||"",""+(g?"":c)+"(?:"+(g?c:"")+(d||"")+(f||d&&"([^/.]+?)"||"([^/]+?)")+")"+(g||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");k[a]={path:new RegExp("^"+c+"$","i"),keys:b}}}function h(){window.addEventListener?window.addEventListener("hashchange",f,!1):window.attachEvent("onhashchange",f)}var i=kickStart,j={},k={};h();var l={add:a,remove:b,go:c,get:d,process:f,list:e,onAdd:null,onRemove:null,onRoute:null};return"undefined"!=typeof w2utils&&$.extend(l,w2utils.event,{handlers:[]}),l});